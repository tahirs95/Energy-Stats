<!doctype html>
{% load static %}
<html lang="en">
  <head>
    <title>Energy Compliance</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800" rel="stylesheet">
    <link rel="icon" type="image/png" href="{% static "images/icons/favicon.ico" %}"/>

    <link rel="stylesheet" href="{% static "css3/bootstrap.css" %}">
    <link rel="stylesheet" href="{% static "css3/animate.css" %}">
    <link rel="stylesheet" href="{% static "css3/owl.carousel.min.css" %}">
    <link rel="stylesheet" href="{% static "css3/bootstrap-datepicker.css" %}">
    <link rel="stylesheet" href="{% static "css3/jquery.timepicker.css" %}">

    <link rel="stylesheet" href="{% static "fonts3/ionicons/css/ionicons.min.css" %}">
    <link rel="stylesheet" href="{% static "fonts3/fontawesome/css/font-awesome.min.css" %}">

    <link rel="stylesheet" href="{% static "fonts3/flaticon/font/flaticon.css" %}">

    <!-- Theme Style -->
    <link rel="stylesheet" href="{% static "css3/style.css" %}">
  </head>
  <style>
    .btn-primary {
      color: #111;
      background-color: #2cab5a;
      border-color: #2cab5a;
    }

    a {
      color: #2cab5a;
    }

    header .navbar {
      padding-top: 1rem;
      padding-bottom: 1rem;
      background: white !important;
    }

    .btn-lg:hover {
      background-color: #2db92d !important;
    }

    .btn-primary:hover {
      background-color: #2db92d !important;
    }
  </style>

  <body>
    
    <header role="banner">
      <nav class="navbar navbar-light bg-light justify-content-between">
        <a href="/survey/" class="navbar-brand"><img src="{% static "img/logo1.jpg" %}" alt="Bootstrappin'" width="150"></a>
        <a href="/survey/" class="navbar-brand text-center" style="font-size:30px;">ENERGY COMPLIANCE</a>
        <form id="in" class="form-inline">
          <a href="{%url 'signup'%}" style="margin-right:4px;" class="btn btn-outline-success my-2 my-sm-0">SIGN UP</a>
          <a href="{%url 'login'%}" class="btn btn-outline-success my-2 my-sm-0">LOGIN</a>
        </form>
        <form id="out" class="form-inline">
          <a href="{%url 'logout'%}" class="btn btn-outline-success my-2 my-sm-0">LOGOUT</a>
        </form>
      </nav>
    </header>
  
    
    <section class="home-slider  inner-page owl-carousel">
      <div class="slider-item" style="background-image: url('{% static 'img/im1.jpg' %}');">
        
        <div class="container">
          <div class="row slider-text align-items-center justify-content-center text-center">
            <div class="col-md-7 col-sm-12 element-animate">
              <h1>REPORT</h1>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- END slider -->
    
    <section class="section">
      <div class="container">
        <div class="row justify-content-center mb-5 element-animate">
          <div class="col-md-8 text-center element-animate">
            <img src="{% static "img/logo1.jpg" %}" alt="Bootstrappin'" width="200"><br><br>
          </div>
          <div id="all" class="col-md-8 text-center">
            <h2 class="text-uppercase heading border-bottom mb-4 element-animate">New York City Climate Mobilization Act Compliance Checklist</h2>
            <div class="element-animate" style="display: inline-block; text-align: left"><br>
              <div class="element-animate" id="ver"></div>
              <div class="elememt-animate" id="ver1"></div>
              <div class="elememt-animate" id="ver2"></div>
              <div class="element-animate">
              <p>In addition to the energy reductions listed above your building needs to verify:<br>
                <ul class="list-unstyled check">
                <li>temperature set points for heat and hot water reflect appropriate space occupancy and facility requirements</li>
                <li>all heating system leaks are repaired</li>
                <li>heating system is maintained, including ensuring that system component parts are clean and in good operating conditions</li>
                <li>individual temperature controls are installed or insulated radiator enclosures with temperature controls are on all radiators</li>
                <li>all pipes for heating and/or hot water are insulated</li>
                <li>steam system condensate tank or water tanks are insulated</li>
                <li>indoor and outdoor heating system sensors and boiler controls are installed to allow for proper set points</li>
                <li>all steam traps repaired or replaced such that all are in working order</li>
                <li>steam system master venting at the ends of main, large horizontal pipes, and tops of risers, vertical pipes branching off a main all installed or upgraded</li>
                <li>lighting upgraded to comply with the standards for new systems set forth in section 805 of the New York City energy conservation code and/or applicable standards referenced in such energy code on or prior to December 31, 2024.  - subject to exception 1 in section 28-310.3</li>
                <li>weatherizing and air sealing where appropriate, including windows and ductwork, with focus on whole-building insulation</li>
                <li>timers on exhaust fans installed
                <li>radiant barriers behind all radiators are installed</li></ul></p>
              </div>
            </div>
          </div>
          
        </div>
        <div class="row justify-content-center element-animate"> 
          <div class="btn-toolbar">
            <button onclick="move1()" style="margin-right:20px;" class="btn btn-primary">Download As Text File</button>
            <button onclick="move()" class="btn btn-info" style="color:white;">Send As Email</button>
          </div><br>
        </div>

        <div style="margin-top: 2%" class="row justify-content-center element-animate"> 
          <div id="suc" style="display:none;" class="alert alert-success">
            <strong>Email has been sent successfully!</strong>
          </div>
          <div id="dan" style="display:none;" class="alert alert-danger">
            <strong>Email has not been sent!</strong>
          </div>
        </div>
      </div>
    </section>
    
    <section class="section border-t">
      <div class="container">
        <div class="row justify-content-center mb-5 element-animate">
          <div class="col-md-8 text-center mb-5">
            <h2 class="text-uppercase heading border-bottom mb-4">Testimonial</h2>
          </div>
        </div>

        <div class="row">

          <div class="col-md-12 element-animate">
            <div class="media d-block media-testimonial text-center">
              <img src="{% static "img/person.jpg" %}" alt="Image placeholder" class="img-fluid mb-3">
              <p>Kevin Deiber, <a href="#">Energy Compliance Inc.</a></p>
              <div class="media-body">
                <blockquote>
                  <p>Director</p>  
                </blockquote>

              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <footer class="site-footer" role="contentinfo">
      <div class="container">
        <div class="row">
          <div class="col-md-3">
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            <p class="copyright">Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a></p>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
          </div>
          <div class="col-md-3">
            <ul class="list-unstyled footer-link">
              <li class="d-flex"><span class="mr-3">A:</span><span class="text-black">34 Street Name, City Name Here, United States</span></li>
              <li class="d-flex"><span class="mr-3">T:</span><span class="text-black">+1 242 4942 290</span></li>
              <li class="d-flex"><span class="mr-3">E:</span><span class="text-black">info@yourdomain.com</span></li>
            </ul>
          </div>
          <div class="col-md-3">
            <h3>Quick Links</h3>
            <ul class="list-unstyled footer-link">
              <li><a href="#">About</a></li>
              <li><a href="#">Services</a></li>
              <li><a href="#">Works</a></li>
              <li><a href="#">Contact</a></li>
            </ul>
          </div>
          <div class="col-md-3">
            <h3>Social</h3>
            <ul class="list-unstyled footer-link d-flex footer-social">
              <li><a href="#" class="p-2"><span class="fa fa-twitter"></span></a></li>
              <li><a href="#" class="p-2"><span class="fa fa-facebook"></span></a></li>
              <li><a href="#" class="p-2"><span class="fa fa-linkedin"></span></a></li>
              <li><a href="#" class="p-2"><span class="fa fa-instagram"></span></a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <!-- END footer -->

    <!-- loader -->
    <div id="loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#f4b214"/></svg></div>

    <script src="{% static "js3/jquery-3.2.1.min.js" %}"></script>
    <script src="{% static "js3/popper.min.js" %}"></script>
    <script src="{% static "js3/bootstrap.min.js" %}"></script>
    <script src="{% static "js3/owl.carousel.min.js" %}"></script>
    <script src="{% static "js3/jquery.waypoints.min.js" %}"></script>
    <script src="{% static "js3/main.js" %}"></script>

    <script>
      var settings = {
        "async": true,
        "crossDomain": true,
        "url": "http://127.0.0.1:8000/survey/get_user",
        "method": "GET"
      }

      $.ajax(settings).done(function (response) {
        console.log(response.status);
        if(response.status == "False") {
          $("#out").hide();
          $("#in").show();
        } else {
          $("#in").hide();
          $("#out").show();
        }
      });

      var d = {
        "user_email": localStorage.getItem("username")
      };

      console.log(localStorage.getItem("username"));
      var settings = {
        "async": true,
        "crossDomain": true,
        "url": "http://127.0.0.1:8000/survey/building",
        "method": "POST",
        "data": JSON.stringify(d)
      }

      $.ajax(settings).done(function (response) {
        var res = response.dict[Object.keys(response.dict).length-1]
        console.log(Object.keys(res.uses)[0]);
        var myTotal = 0;  
        for(var i = 0, len = res.aggregated_bills.length; i < len; i++) {
            myTotal +=res.aggregated_bills[i];
        };
        console.log(myTotal);
        a = '<ul class="list-unstyled check">';
        b = '<p>To meet the compliance requirements with ';
        c = '<ul class="list-unstyled check">'
        for(var i=0;i<Object.keys(res.uses).length;i++) {
            console.log(Object.keys(res.uses)[i]);
            console.log(res.aggregated_bills[i]);
            a = a + '<li>Currently <b>'+((res.aggregated_bills[i]/myTotal)*100).toFixed(2)+'%</b>'+' of your building energy use is <b>'+Object.keys(res.uses)[i]+'</b>.</li>';
            b = b + '<b>'+((res.aggregated_bills[i]/myTotal)*100).toFixed(2)+'%</b> coming from <b>'+Object.keys(res.uses)[i]+'</b>, ';
            if(Object.keys(res.uses)[i] == "Electricity") {
                c = c + '<li>' + res.aggregated_bills[i] + ' kWh (<b>'+ Object.keys(res.uses)[i] + '</b>)</li>';
            } else {
                c = c + '<li>' +res.aggregated_bills[i] + ' kBTU (<b>'+ Object.keys(res.uses)[i] + '</b>)</li>';
            }
        }
        document.getElementById("ver").innerHTML = a + '</ul>';
        document.getElementById("ver1").innerHTML = b + ' your building will need to reduce as follows:</p>';
        document.getElementById("ver2").innerHTML = c +'</ul>';
      }); 

      function move() {

        var header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' "+
            "xmlns:w='urn:schemas-microsoft-com:office:word' "+
            "xmlns='http://www.w3.org/TR/REC-html40'>"+
            "<head><meta charset='utf-8'><title>Export HTML to Word Document with JavaScript</title></head><body>";
        var footer = "</body></html>";
        var sourceHTML = header+document.getElementById("all").innerHTML+footer;
        
        var settings = {
          "async": true,
          "crossDomain": true,
          "url": "http://127.0.0.1:8000/survey/get_user",
          "method": "GET"
        }

        $.ajax(settings).done(function (response) {
          console.log(response.status);
          if(response.status == "False") {
           var person = prompt("Please enter your email address:");
           var res = validateEmail(person);
           console.log(person);
           console.log(res);
           if(res == true) {
              var d = {
                "email": person,
                "message": sourceHTML
              };

              var settings = {
                "async": true,
                "crossDomain": true,
                "url": "http://127.0.0.1:8000/survey/email",
                "method": "POST",
                "data": JSON.stringify(d)
              }

              $.ajax(settings).done(function (response) {
                console.log(response);
                if(response.status == "True") {
                  $("#suc").show();
                  $("#dan").hide();
                } else {
                  $("#dan").show();
                  $("#suc").hide();
                }
              });
            }
            
          } else {
            var d = {
              "message": sourceHTML
            };

            var settings = {
              "async": true,
              "crossDomain": true,
              "url": "http://127.0.0.1:8000/survey/email",
              "method": "POST",
              "data": JSON.stringify(d)
            }

            $.ajax(settings).done(function (response) {
              console.log(response);
              if(response.status == "True") {
                $("#suc").show();
                $("#dan").hide();
              } else {
                $("#dan").show();
                $("#suc").hide(); 
              }
            });
          }
        });
      }

      function validateEmail(emailField){
        return(emailField.includes("@") && emailField.includes(".com"));
      }
      function move1() {
        var header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' "+
            "xmlns:w='urn:schemas-microsoft-com:office:word' "+
            "xmlns='http://www.w3.org/TR/REC-html40'>"+
            "<head><meta charset='utf-8'><title>Export HTML to Word Document with JavaScript</title></head><body>";
        var footer = "</body></html>";
        var sourceHTML = header+document.getElementById("all").innerHTML+footer;
        console.log(sourceHTML);
        var source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
        console.log(source);
        var fileDownload = document.createElement("a");
        document.body.appendChild(fileDownload);
        fileDownload.href = source;
        fileDownload.download = 'document.doc';
        fileDownload.click();
        document.body.removeChild(fileDownload);
      }
        
       
    </script>
  </body>
</html>